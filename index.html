<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>AR Clean Energy Explorer</title>

<script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.js"></script>

<style>
body { margin: 0; overflow: hidden; font-family: system-ui; }
#ui { position: fixed; left: 0; right: 0; bottom: 0; background: rgba(15,23,42,.8); color: white; padding: 12px 12px 80px; display: flex; gap: 10px; flex-wrap: wrap; }
button { padding: 10px 12px; border: 0; border-radius: 12px; background: white; font-weight: bold; cursor: pointer; }
button.secondary { background: #38bdf8; }
.pill { padding:6px 10px; border-radius:999px; background:rgba(255,255,255,.12); font-size:12px;}
</style>
</head>

<body>

<a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;">

<a-assets>
<a-asset-item id="m-fan" src="3D_MODEL/simple_fan.glb"></a-asset-item>
<a-asset-item id="m-bulb" src="3D_MODEL/led_light_bulb.glb"></a-asset-item>
<a-asset-item id="m-solar" src="3D_MODEL/Flat_Solar_Panel.glb"></a-asset-item>
<a-asset-item id="m-wind" src="3D_MODEL/Wind_Turbine.glb"></a-asset-item>
</a-assets>

<!-- TV MARKER -->
<a-marker type="pattern" url="MARKER/tv-marker.patt" emitevents="true" id="marker-tv">
  <a-entity id="device-tv" position="-0.4 0.3 0" visible="false"></a-entity>
  <a-entity id="renew-tv" position="0.4 0.3 0" visible="false"></a-entity>
</a-marker>

<!-- FAN MARKER -->
<a-marker type="pattern" url="MARKER/fan-marker.patt" emitevents="true" id="marker-fan">
  <a-entity id="device-fan" position="-0.4 0.3 0" visible="false"></a-entity>
  <a-entity id="renew-fan" position="0.4 0.3 0" visible="false"></a-entity>
</a-marker>

<!-- BULB MARKER -->
<a-marker type="pattern" url="MARKER/bulb-marker.patt" emitevents="true" id="marker-bulb">
  <a-entity id="device-bulb" position="-0.4 0.3 0" visible="false"></a-entity>
  <a-entity id="renew-bulb" position="0.4 0.3 0" visible="false"></a-entity>
</a-marker>

<a-entity camera></a-entity>
</a-scene>

<div id="ui">
<div class="pill" id="status">Waiting for marker...</div>
<button class="secondary" onclick="pickRenewable('Solar')">Solar</button>
<button class="secondary" onclick="pickRenewable('Wind')">Wind</button>
</div>

<script>

let activeMarkerId = null;

const status = document.querySelector('#status');

function showDevice(markerId, type){

activeMarkerId = markerId;

const device = document.querySelector(`#device-${markerId}`);
device.setAttribute('visible', true);
device.removeAttribute('gltf-model');
device.removeAttribute('geometry');
device.removeAttribute('material');

if(type === "TV"){
device.setAttribute('geometry','primitive: box');
device.setAttribute('material','color: #111');
device.setAttribute('scale','0.6 0.3 0.05');
}
else if(type === "Fan"){
device.setAttribute('gltf-model','#m-fan');
device.setAttribute('scale','0.5 0.5 0.5');
device.setAttribute('rotation','-90 0 0');
}
else if(type === "Bulb"){
device.setAttribute('gltf-model','#m-bulb');
device.setAttribute('scale','10 10 10');
}

status.textContent = type + " detected âœ…";
}

function hideAll(markerId){
document.querySelector(`#device-${markerId}`).setAttribute('visible', false);
document.querySelector(`#renew-${markerId}`).setAttribute('visible', false);
activeMarkerId = null;
status.textContent = "Waiting for marker...";
}

function pickRenewable(type){
if(!activeMarkerId) return;

const renew = document.querySelector(`#renew-${activeMarkerId}`);
renew.setAttribute('visible', true);
renew.removeAttribute('gltf-model');
renew.setAttribute('rotation','-90 0 0');
renew.setAttribute('scale','0.4 0.4 0.4');

if(type === "Solar"){
renew.setAttribute('gltf-model','#m-solar');
}
else{
renew.setAttribute('gltf-model','#m-wind');
}
}

document.querySelector('#marker-tv').addEventListener('markerFound',()=>showDevice("tv","TV"));
document.querySelector('#marker-fan').addEventListener('markerFound',()=>showDevice("fan","Fan"));
document.querySelector('#marker-bulb').addEventListener('markerFound',()=>showDevice("bulb","Bulb"));

document.querySelector('#marker-tv').addEventListener('markerLost',()=>hideAll("tv"));
document.querySelector('#marker-fan').addEventListener('markerLost',()=>hideAll("fan"));
document.querySelector('#marker-bulb').addEventListener('markerLost',()=>hideAll("bulb"));

</script>

</body>
</html>
