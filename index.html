<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>AR Clean Energy Explorer</title>

<script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.js"></script>

<style>
body { margin: 0; overflow: hidden; font-family: system-ui; }
#ui { position: fixed; left: 0; right: 0; bottom: 0; background: rgba(15,23,42,.8); color: white; padding: 12px 12px 80px; display: flex; gap: 10px; flex-wrap: wrap; }
button { padding: 10px 12px; border: 0; border-radius: 12px; background: white; font-weight: bold; cursor: pointer; }
button.secondary { background: #38bdf8; }
.pill { padding:6px 10px; border-radius:999px; background:rgba(255,255,255,.12); font-size:12px;}
</style>
</head>

<body>

<a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;">

<a-assets>
<a-asset-item id="m-fan" src="3D_MODEL/simple_fan.glb"></a-asset-item>
<a-asset-item id="m-bulb" src="3D_MODEL/led_light_bulb.glb"></a-asset-item>
<a-asset-item id="m-solar" src="3D_MODEL/Flat_Solar_Panel.glb"></a-asset-item>
<a-asset-item id="m-wind" src="3D_MODEL/Wind_Turbine.glb"></a-asset-item>
</a-assets>

<a-marker type="pattern" url="MARKER/tv-marker.patt" id="marker-tv"></a-marker>
<a-marker type="pattern" url="MARKER/fan-marker.patt" id="marker-fan"></a-marker>
<a-marker type="pattern" url="MARKER/bulb-marker.patt" id="marker-bulb"></a-marker>

<a-entity id="device" visible="false"></a-entity>
<a-entity id="renewable" visible="false"></a-entity>

<a-entity camera></a-entity>
</a-scene>

<div id="ui">
<div class="pill" id="status">Waiting for marker...</div>
<button class="secondary" onclick="pickRenewable('Solar')">Solar</button>
<button class="secondary" onclick="pickRenewable('Wind')">Wind</button>
</div>

<script>

const DEVICE_MODEL = {
TV: null,
Fan: "#m-fan",
Bulb: "#m-bulb"
};

const RENEW_MODEL = {
Solar: "#m-solar",
Wind: "#m-wind"
};

let currentDevice = null;

const deviceEl = document.querySelector('#device');
const renewableEl = document.querySelector('#renewable');
const status = document.querySelector('#status');

function attachTo(marker){
marker.appendChild(deviceEl);
marker.appendChild(renewableEl);
}

function showDevice(type, marker){
currentDevice = type;
attachTo(marker);

deviceEl.setAttribute('visible', true);
deviceEl.setAttribute('position', '-0.3 0.2 0');
deviceEl.setAttribute('rotation', '0 0 0');
deviceEl.setAttribute('scale', '0.2 0.2 0.2');

deviceEl.removeAttribute('gltf-model');
deviceEl.removeAttribute('geometry');

if(type === "TV"){
deviceEl.setAttribute('geometry','primitive: box');
deviceEl.setAttribute('material','color: #111');
}else{
deviceEl.setAttribute('gltf-model', DEVICE_MODEL[type]);
}

renewableEl.setAttribute('visible', false);
status.textContent = type + " detected âœ…";
}

function pickRenewable(type){
if(!currentDevice) return;

renewableEl.setAttribute('visible', true);
renewableEl.setAttribute('position', '0.3 0.2 0');
renewableEl.setAttribute('rotation', '-90 0 0');
renewableEl.setAttribute('scale', '0.2 0.2 0.2');

renewableEl.removeAttribute('gltf-model');
renewableEl.setAttribute('gltf-model', RENEW_MODEL[type]);
}

function hideAll(){
deviceEl.setAttribute('visible', false);
renewableEl.setAttribute('visible', false);
currentDevice = null;
status.textContent = "Waiting for marker...";
}

document.querySelector('#marker-tv').addEventListener('markerFound', e=>{
showDevice("TV", e.target);
});
document.querySelector('#marker-fan').addEventListener('markerFound', e=>{
showDevice("Fan", e.target);
});
document.querySelector('#marker-bulb').addEventListener('markerFound', e=>{
showDevice("Bulb", e.target);
});

document.querySelector('#marker-tv').addEventListener('markerLost', hideAll);
document.querySelector('#marker-fan').addEventListener('markerLost', hideAll);
document.querySelector('#marker-bulb').addEventListener('markerLost', hideAll);

</script>

</body>
</html>
