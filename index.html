<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>AR Clean Energy Explorer</title>

<script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.js"></script>

<style>
body { margin: 0; overflow: hidden; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
#ui { position: fixed; left: 0; right: 0; bottom: 0; background: rgba(15, 23, 42, 0.85); color: white; padding: 12px 12px 80px 12px; display: flex; gap: 10px; flex-wrap: wrap; align-items: center; }
.pill { padding: 6px 10px; border-radius: 999px; background: rgba(255,255,255,0.12); font-size: 12px; }
#row { display:flex; gap:10px; flex-wrap:wrap; width:100%; align-items:center; }
button { padding: 10px 12px; border: 0; border-radius: 12px; background: #ffffff; color: #0f172a; font-weight: 800; cursor: pointer; }
button.secondary { background: #38bdf8; color: #06283d; }
#demoBtn { display: none; position: fixed; bottom: 15px; left: 50%; transform: translateX(-50%); padding: 12px 28px; font-size: 15px; font-weight: 800; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 30px; z-index: 100; }
input[type="range"] { width: 220px; }
#info { width: 100%; margin-top: 6px; font-size: 14px; }
</style>
</head>

<body>

<a-scene embedded
         arjs="sourceType: webcam;
               debugUIEnabled: false;
               detectionMode: mono;
               trackingMethod: best;
               maxDetectionRate: 60;">

<a-assets>
<a-asset-item id="m-fan"  src="3D_MODEL/simple_fan.glb"></a-asset-item>
<a-asset-item id="m-bulb" src="3D_MODEL/led_light_bulb.glb"></a-asset-item>
<a-asset-item id="m-solar" src="3D_MODEL/Flat_Solar_Panel.glb"></a-asset-item>
<a-asset-item id="m-wind"  src="3D_MODEL/Wind_Turbine.glb"></a-asset-item>
</a-assets>

<!-- TV MARKER -->
<a-marker type="pattern" url="MARKER/tv-marker.patt"
          smooth="true" smoothCount="5"
          emitevents="true" id="marker-tv">

  <a-entity id="device-left" visible="false"></a-entity>
  <a-entity id="renewable-right" visible="false"></a-entity>

</a-marker>

<!-- FAN MARKER -->
<a-marker type="pattern" url="MARKER/fan-marker.patt"
          smooth="true" smoothCount="5"
          emitevents="true" id="marker-fan">

  <a-entity id="device-left" visible="false"></a-entity>
  <a-entity id="renewable-right" visible="false"></a-entity>

</a-marker>

<!-- BULB MARKER -->
<a-marker type="pattern" url="MARKER/bulb-marker.patt"
          smooth="true" smoothCount="5"
          emitevents="true" id="marker-bulb">

  <a-entity id="device-left" visible="false"></a-entity>
  <a-entity id="renewable-right" visible="false"></a-entity>

</a-marker>

<a-entity camera></a-entity>
</a-scene>

<div id="ui">
<div class="pill" id="status">Status: Waiting for marker…</div>

<div id="row">
<button onclick="selectRenewable('Solar')">Solar</button>
<button onclick="selectRenewable('Wind')">Wind</button>
</div>

</div>

<script>

let activeMarker = null;
let activeDevice = null;

const DEVICE_MODEL = {
  TV: null,
  Fan: '#m-fan',
  Bulb: '#m-bulb'
};

const RENEW_MODEL = {
  Solar: '#m-solar',
  Wind: '#m-wind'
};

function showDevice(marker, type){
  const device = marker.querySelector('#device-left');
  const renewable = marker.querySelector('#renewable-right');

  device.setAttribute('visible', true);
  renewable.setAttribute('visible', false);
  renewable.removeAttribute('gltf-model');

  device.setAttribute('position', '-0.3 0.2 0');
  device.setAttribute('scale', type === 'Bulb' ? '5 5 5' : '0.2 0.2 0.2');

  device.removeAttribute('gltf-model');
  device.removeAttribute('geometry');
  device.removeAttribute('material');

  if(type === 'TV'){
    device.setAttribute('geometry','primitive: box');
    device.setAttribute('material','color: #111');
  } else {
    device.setAttribute('gltf-model', DEVICE_MODEL[type]);
  }

  activeMarker = marker;
  activeDevice = type;
}

function selectRenewable(type){
  if(!activeMarker) return;

  const renewable = activeMarker.querySelector('#renewable-right');

  renewable.setAttribute('visible', true);
  renewable.setAttribute('position', '0.3 0.2 0');
  renewable.setAttribute('scale', '0.3 0.3 0.3');
  renewable.setAttribute('rotation', '-90 0 0');
  renewable.setAttribute('gltf-model', RENEW_MODEL[type]);
}

function hideAll(marker){
  marker.querySelector('#device-left').setAttribute('visible', false);
  marker.querySelector('#renewable-right').setAttribute('visible', false);
}

['tv','fan','bulb'].forEach(name=>{
  const marker = document.querySelector(`#marker-${name}`);
  const type = name.charAt(0).toUpperCase()+name.slice(1);

  marker.addEventListener('markerFound',()=>{
    document.getElementById('status').textContent = `${type} detected ✅`;
    showDevice(marker, type);
  });

  marker.addEventListener('markerLost',()=>{
    document.getElementById('status').textContent = `Waiting for marker…`;
    hideAll(marker);
    activeMarker = null;
  });
});

</script>

</body>
</html>
