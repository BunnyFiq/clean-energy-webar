<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>AR Clean Energy Explorer</title>

    <!-- A-Frame -->
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <!-- AR.js for A-Frame -->
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.js"></script>

    <style>
      body { margin: 0; overflow: hidden; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }

      #ui {
        position: fixed; left: 0; right: 0; bottom: 0;
        background: rgba(15, 23, 42, 0.78);
        color: white;
        padding: 12px;
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        align-items: center;
      }

      .pill {
        padding: 6px 10px;
        border-radius: 999px;
        background: rgba(255,255,255,0.12);
        font-size: 12px;
      }

      #row { display:flex; gap:10px; flex-wrap:wrap; width:100%; align-items:center; }

      button {
        padding: 10px 12px;
        border: 0;
        border-radius: 12px;
        background: #ffffff;
        color: #0f172a;
        font-weight: 800;
        cursor: pointer;
      }
      button.secondary { background: #38bdf8; color: #06283d; }

      input[type="range"] { width: 220px; }
      #info { width: 100%; margin-top: 6px; font-size: 14px; opacity: 0.95; line-height: 1.3; }
    </style>
  </head>

  <body>
    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;">
      <a-assets>
        <!-- Devices -->
        <a-asset-item id="m-tv"   src="3D_MODEL/smart_tv.glb"></a-asset-item>
        <a-asset-item id="m-fan"  src="3D_MODEL/simple_fan.glb"></a-asset-item>
        <a-asset-item id="m-bulb" src="3D_MODEL/led_light_bulb.glb"></a-asset-item>

        <!-- Renewables -->
        <a-asset-item id="m-solar" src="3D_MODEL/Flat_Solar_Panel.glb"></a-asset-item>
        <a-asset-item id="m-wind"  src="3D_MODEL/Wind_Turbine.glb"></a-asset-item>
      </a-assets>

      <!-- Marker -->
      <a-marker preset="hiro" emitevents="true" id="marker">
        <!-- Device in the middle -->
        <a-entity id="device"
                  gltf-model="#m-tv"
                  position="0 0 0"
                  rotation="0 0 0"
                  scale="0.85 0.85 0.85"></a-entity>

        <!-- Renewable also centered, slightly behind on Z -->
        <a-entity id="renewable"
                  gltf-model="#m-solar"
                  position="0 0 -0.6"
                  rotation="0 0 0"
                  scale="0.75 0.75 0.75"
                  visible="false"></a-entity>
      </a-marker>

      <a-entity camera></a-entity>
    </a-scene>

    <!-- UI -->
    <div id="ui">
      <div class="pill" id="status">Status: Waiting for marker…</div>

      <div id="row">
        <button onclick="pickDevice('TV')">TV</button>
        <button onclick="pickDevice('Fan')">Fan</button>
        <button onclick="pickDevice('Bulb')">Bulb</button>

        <button class="secondary" onclick="pickRenewable('Solar')">Solar</button>
        <button class="secondary" onclick="pickRenewable('Wind')">Wind</button>

        <button class="secondary" onclick="goDemo()">Demo</button>
      </div>

      <div id="row">
        <span class="pill">Hours/day: <span id="hoursLabel">4</span></span>
        <input id="hours" type="range" min="1" max="24" value="4" oninput="updateHours(this.value)" />
        <span class="pill">Energy: <span id="energyLabel">480</span> Wh/day</span>
        <span class="pill" id="recommended">Recommended: Solar</span>
      </div>

      <div id="info">
        Step 1: Choose TV/Fan/Bulb. Step 2: Choose Solar/Wind. Step 3: Tap Demo.
      </div>
    </div>

    <script>
      // Demo watt values
      const DEVICE_WATTS = { TV: 120, Fan: 50, Bulb: 10 };

      // Model ids in <a-assets>
      const DEVICE_MODEL = { TV: '#m-tv', Fan: '#m-fan', Bulb: '#m-bulb' };
      const RENEW_MODEL  = { Solar: '#m-solar', Wind: '#m-wind' };

      let selectedDevice = 'TV';
      let selectedRenew = 'Solar';
      let hoursPerDay = 4;

      const deviceEl = () => document.querySelector('#device');
      const renewEl  = () => document.querySelector('#renewable');

      function whPerDay(w, h) { return Math.round(w * h); }

      function updateUI() {
        const watts = DEVICE_WATTS[selectedDevice];
        const wh = whPerDay(watts, hoursPerDay);
        document.querySelector('#energyLabel').textContent = String(wh);
        document.querySelector('#hoursLabel').textContent = String(hoursPerDay);

        const rec = (selectedDevice === 'Bulb') ? 'Solar'
                  : (selectedDevice === 'Fan') ? 'Wind'
                  : 'Try both';
        document.querySelector('#recommended').textContent = `Recommended: ${rec}`;

        document.querySelector('#info').textContent =
          `${selectedDevice}: ${watts}W × ${hoursPerDay}h/day = ${wh} Wh/day. Selected: ${selectedRenew}.`;
      }

      // Reliable swap
      function swapModel(el, assetId) {
        el.removeAttribute('gltf-model');
        el.setAttribute('gltf-model', assetId);
      }

      function setDeviceScale(name) {
        const d = deviceEl();

        // You can adjust these numbers if still too small/big.
        if (name === 'Bulb') d.setAttribute('scale', '1.25 1.25 1.25');     // bigger bulb
        else if (name === 'TV') d.setAttribute('scale', '1.00 1.00 1.00');  // bigger TV
        else d.setAttribute('scale', '0.90 0.90 0.90');                     // fan
      }

      function pickDevice(name) {
        selectedDevice = name;
        swapModel(deviceEl(), DEVICE_MODEL[name]);
        setDeviceScale(name);
        updateUI();
      }

      function pickRenewable(type) {
        selectedRenew = type;

        const r = renewEl();
        r.setAttribute('visible', true);
        swapModel(r, RENEW_MODEL[type]);

        // Keep in the middle, slightly behind device
        r.setAttribute('position', '0 0 -0.6');

        // Wind spins; Solar does not
        r.removeAttribute('animation');
        if (type === 'Wind') {
          r.setAttribute('animation', 'property: rotation; to: 0 360 0; loop: true; dur: 1200; easing: linear;');
        }

        updateUI();
      }

      function updateHours(v) {
        hoursPerDay = Number(v);
        updateUI();
      }

      function goDemo() {
        // Your videos use: *_solar.mp4 and *_turbine.mp4
        const d = selectedDevice.toLowerCase(); // tv/fan/bulb
        const r = (selectedRenew.toLowerCase() === 'wind') ? 'turbine' : 'solar';
        location.href = `demo.html?device=${encodeURIComponent(d)}&renew=${encodeURIComponent(r)}`;
      }

      // Marker status
      const marker = document.querySelector('#marker');
      const status = document.querySelector('#status');

      marker.addEventListener('markerFound', () => {
        status.textContent = 'Status: Marker found ✅';
        // Ensure the scene is correct as soon as marker is found
        pickDevice(selectedDevice);
        pickRenewable(selectedRenew);
      });

      marker.addEventListener('markerLost', () => {
        status.textContent = 'Status: Waiting for marker…';
      });

      // Initial UI (before marker found)
      updateUI();
      setDeviceScale(selectedDevice);
    </script>
  </body>
</html>
