<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>AR Clean Energy Explorer</title>

    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.js"></script>

    <style>
      body { margin: 0; overflow: hidden; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
      #ui {
        position: fixed; left: 0; right: 0; bottom: 0;
        background: rgba(15, 23, 42, 0.78);
        color: white;
        padding: 12px;
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        align-items: center;
      }
      .pill { padding: 6px 10px; border-radius: 999px; background: rgba(255,255,255,0.12); font-size: 12px; }
      #row { display:flex; gap:10px; flex-wrap:wrap; width:100%; align-items:center; }
      button { padding: 10px 12px; border: 0; border-radius: 12px; background: #ffffff; color: #0f172a; font-weight: 800; cursor: pointer; }
      button.secondary { background: #38bdf8; color: #06283d; }
      input[type="range"] { width: 220px; }
      #info { width: 100%; margin-top: 6px; font-size: 14px; opacity: 0.95; line-height: 1.3; }
    </style>
  </head>

  <body>
    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;">
      <a-assets>
        <a-asset-item id="m-tv"   src="3D_MODEL/smart_tv.glb"></a-asset-item>
        <a-asset-item id="m-fan"  src="3D_MODEL/simple_fan.glb"></a-asset-item>
        <a-asset-item id="m-bulb" src="3D_MODEL/led_light_bulb.glb"></a-asset-item>

        <a-asset-item id="m-solar" src="3D_MODEL/Flat_Solar_Panel.glb"></a-asset-item>
        <a-asset-item id="m-wind"  src="3D_MODEL/Wind_Turbine.glb"></a-asset-item>
      </a-assets>

      <a-marker preset="hiro" emitevents="true" id="marker"
                smooth="true" smoothCount="5" smoothTolerance="0.01" smoothThreshold="2">

        <a-entity id="device" gltf-model="#m-tv"></a-entity>

        <a-entity id="renewablePivot" visible="false">
          <a-entity id="renewable"></a-entity>
        </a-entity>

      </a-marker>

      <a-entity camera></a-entity>
    </a-scene>

    <div id="ui">
      <div class="pill" id="status">Status: Waiting for marker…</div>

      <div id="row">
        <button onclick="pickDevice('TV')">TV</button>
        <button onclick="pickDevice('Fan')">Fan</button>
        <button onclick="pickDevice('Bulb')">Bulb</button>

        <button class="secondary" onclick="pickRenewable('Solar')">Solar</button>
        <button class="secondary" onclick="pickRenewable('Wind')">Wind</button>

        <button class="secondary" onclick="goDemo()">Demo</button>
      </div>

      <div id="row">
        <span class="pill">Hours/day: <span id="hoursLabel">4</span></span>
        <input id="hours" type="range" min="1" max="24" value="4" oninput="updateHours(this.value)" />
        <span class="pill">Energy: <span id="energyLabel">480</span> Wh/day</span>
        <span class="pill" id="recommended">Recommended: Solar</span>
      </div>

      <div id="info">Open DevTools Console if model not visible.</div>
    </div>

    <script>
      // rotation is "x y z" in degrees. [web:514]
      const MODEL_CONFIG = {
        // Make TV obviously visible:
        TV: { pos: '-0.25 0.25 0', scale: '0.04 0.04 0.04', rot: '0 0 0' },

        // "Standing straight" defaults (if any still wrong, flip X between 90 and -90):
        Fan:  { pos: '-0.25 0.20 0', scale: '0.8 0.8 0.8', rot: '-90 0 0' },
        Bulb: { pos: '-0.25 0.20 0', scale: '3 3 3', rot: '0 0 0' },

        // Solar panel: if you want it vertical, keep -90. If you want it flat on marker, use 0 0 0.
        Solar:{ pos: '0.25 0.20 0',  scale: '1.2 1.2 1.2',  rot: '-90 0 0' },

        Wind: { pos: '0.25 0.20 0',  scale: '1.2 1.2 1.2',  rot: '-90 0 0' }
      };

      const DEVICE_WATTS = { TV: 120, Fan: 50, Bulb: 10 };
      const DEVICE_MODEL = { TV: '#m-tv', Fan: '#m-fan', Bulb: '#m-bulb' };
      const RENEW_MODEL  = { Solar: '#m-solar', Wind: '#m-wind' };

      let selectedDevice = 'TV';
      let selectedRenew = 'Solar';
      let hoursPerDay = 4;

      const deviceEl = () => document.querySelector('#device');
      const renewPivotEl = () => document.querySelector('#renewablePivot');
      const renewEl  = () => document.querySelector('#renewable');

      function whPerDay(w, h) { return Math.round(w * h); }

      function updateUI() {
        const watts = DEVICE_WATTS[selectedDevice];
        const wh = whPerDay(watts, hoursPerDay);
        document.querySelector('#energyLabel').textContent = String(wh);
        document.querySelector('#hoursLabel').textContent = String(hoursPerDay);

        const rec = (selectedDevice === 'Bulb') ? 'Solar'
                  : (selectedDevice === 'Fan') ? 'Wind'
                  : 'Try both';
        document.querySelector('#recommended').textContent = `Recommended: ${rec}`;

        document.querySelector('#info').textContent =
          `${selectedDevice}: ${watts}W × ${hoursPerDay}h/day = ${wh} Wh/day. Selected: ${selectedRenew}.`;
      }

      function swapModel(el, assetId) {
        el.removeAttribute('gltf-model');
        el.setAttribute('gltf-model', assetId);
      }

      function applyTransform(el, cfg) {
        el.setAttribute('position', cfg.pos);
        el.setAttribute('scale', cfg.scale);
        el.setAttribute('rotation', cfg.rot);
      }

      // Debug: tell us if model actually loads or fails. [web:581]
      function attachModelDebug(el, label) {
        el.addEventListener('model-loaded', () => console.log(`[OK] ${label} model-loaded`));
        el.addEventListener('model-error', (e) => console.error(`[FAIL] ${label} model-error`, e));
      }

      attachModelDebug(deviceEl(), 'device');
      attachModelDebug(renewEl(), 'renewable');

      function pickDevice(name) {
        selectedDevice = name;
        const d = deviceEl();

        swapModel(d, DEVICE_MODEL[name]);
        applyTransform(d, MODEL_CONFIG[name]);
        d.setAttribute('visible', true);

        updateUI();
      }

      function pickRenewable(type) {
        selectedRenew = type;

        const pivot = renewPivotEl();
        const child = renewEl();

        pivot.setAttribute('visible', true);
        applyTransform(pivot, MODEL_CONFIG[type]);

        child.setAttribute('position', '0 0 0');
        child.setAttribute('rotation', '0 0 0');
        child.setAttribute('scale', '1 1 1');
        child.setAttribute('visible', true);

        swapModel(child, RENEW_MODEL[type]);
        child.removeAttribute('animation');

        updateUI();
      }

      function updateHours(v) {
        hoursPerDay = Number(v);
        updateUI();
      }

      function goDemo() {
        const d = selectedDevice.toLowerCase();
        const r = (selectedRenew.toLowerCase() === 'wind') ? 'turbine' : 'solar';
        location.href = `demo.html?device=${encodeURIComponent(d)}&renew=${encodeURIComponent(r)}`;
      }

      const marker = document.querySelector('#marker');
      const status = document.querySelector('#status');

      marker.addEventListener('markerFound', () => {
        status.textContent = 'Status: Marker found ✅';
        pickDevice(selectedDevice);
        pickRenewable(selectedRenew);
      });

      marker.addEventListener('markerLost', () => {
        status.textContent = 'Status: Waiting for marker…';
      });

      // Start state (so when marker appears, it already has transforms)
      updateUI();
      applyTransform(deviceEl(), MODEL_CONFIG[selectedDevice]);
    </script>
  </body>
</html>

